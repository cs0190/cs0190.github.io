<!doctype HTML>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="codemirror.js"></script>
<script src="runmode.js"></script>
<script src="pyret.js"></script>
<script src="hilite.js"></script>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2.1.9&nbsp;Contracts</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-fonts.css" title="default"/><link rel="stylesheet" type="text/css" href="codemirror.css" title="default"/><link rel="stylesheet" type="text/css" href="pyret.css" title="default"/><link rel="stylesheet" type="text/css" href="styles.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Pyret</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Getting_Started.html" class="tocviewlink" data-pltdoc="x">Getting Started</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Language_Concepts.html" class="tocviewselflink" data-pltdoc="x">Language Concepts</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Builtins_and_Libraries.html" class="tocviewlink" data-pltdoc="x">Builtins and Libraries</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Pyret_Style_Guide.html" class="tocviewlink" data-pltdoc="x">Pyret Style Guide</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Internals.html" class="tocviewlink" data-pltdoc="x">Internals</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Glossary.html" class="tocviewlink" data-pltdoc="x">Glossary</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>2&nbsp;</td><td><a href="Language_Concepts.html" class="tocviewlink" data-pltdoc="x">Language Concepts</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="s_forms.html" class="tocviewselflink" data-pltdoc="x">Language Constructs</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="testing.html" class="tocviewlink" data-pltdoc="x">Testing</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="equality.html" class="tocviewlink" data-pltdoc="x">equality</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="op-precedence.html" class="tocviewlink" data-pltdoc="x">Operator Precedence</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="brands.html" class="tocviewlink" data-pltdoc="x">Brands</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="type-check.html" class="tocviewlink" data-pltdoc="x">Type Checking</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="s_spies.html" class="tocviewlink" data-pltdoc="x">Spies</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>2.1&nbsp;</td><td><a href="s_forms.html" class="tocviewlink" data-pltdoc="x">Language Constructs</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1.1&nbsp;</td><td><a href="s_literals.html" class="tocviewlink" data-pltdoc="x">Primitives and Literals</a></td></tr><tr><td align="right">2.1.2&nbsp;</td><td><a href="s_comments.html" class="tocviewlink" data-pltdoc="x">Comments</a></td></tr><tr><td align="right">2.1.3&nbsp;</td><td><a href="s_program.html" class="tocviewlink" data-pltdoc="x">Programs</a></td></tr><tr><td align="right">2.1.4&nbsp;</td><td><a href="Import_Statements.html" class="tocviewlink" data-pltdoc="x">Import Statements</a></td></tr><tr><td align="right">2.1.5&nbsp;</td><td><a href="Provide_Statements.html" class="tocviewlink" data-pltdoc="x">Provide Statements</a></td></tr><tr><td align="right">2.1.6&nbsp;</td><td><a href="Bindings.html" class="tocviewlink" data-pltdoc="x">Bindings</a></td></tr><tr><td align="right">2.1.7&nbsp;</td><td><a href="Blocks.html" class="tocviewlink" data-pltdoc="x">Blocks</a></td></tr><tr><td align="right">2.1.8&nbsp;</td><td><a href="s_declarations.html" class="tocviewlink" data-pltdoc="x">Declarations</a></td></tr><tr><td align="right">2.1.9&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Contracts</a></td></tr><tr><td align="right">2.1.10&nbsp;</td><td><a href="Statements.html" class="tocviewlink" data-pltdoc="x">Statements</a></td></tr><tr><td align="right">2.1.11&nbsp;</td><td><a href="Expressions.html" class="tocviewlink" data-pltdoc="x">Expressions</a></td></tr><tr><td align="right">2.1.12&nbsp;</td><td><a href="s_annotations.html" class="tocviewlink" data-pltdoc="x">Annotations</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="s_declarations.html" title="backward to &quot;2.1.8 Declarations&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="s_forms.html" title="up to &quot;2.1 Language Constructs&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Statements.html" title="forward to &quot;2.1.10 Statements&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h5>2.1.9<tt>&nbsp;</tt><a name="(part._s~3acontracts)"></a>Contracts</h5><p>As part of its support for the systematic design of functions, Pyret allows
developers to specify an annotation for a name, before that name is defined.
For example,</p><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p>the-answer :: Number
the-answer = 42

double :: String -&gt; String
fun double(s): s + s end</p></pre></pre><p>In both of these cases, the definition itself (of <span class="pyret-highlight"><span class="stt">the-answer</span></span> and
<span class="pyret-highlight"><span class="stt">double</span></span>) is preceded by a <span style="font-style: italic">contract</span> statement, asserting the
signature of the definition to follow.  Pyret treats these contracts specially,
and weaves them in to the definitions: the previous examples are equivalent to</p><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p>the-answer :: Number = 42

fun double(s :: String) -&gt; String: s + s end</p></pre></pre><p>The grammar for these contracts looks nearly identical to that of
<a href="Bindings.html#%28elem._%28bnf-prod._%28.Pyret._name-binding%29%29%29" data-pltdoc="x">&#8249;name-binding&#8250;</a>s.  Function annotations are given a slightly more
relaxed treatment: the outermost set of parentheses are optional.</p><blockquote class="SCodeFlow" style="white-space: pre;"><p><a name="(elem._(bnf-prod._(.Pyret._contract)))"></a><span class="bnf-rule">&#8249;contract&#8250;</span><span class="bnf-meta">:</span> <span class="bnf-lit bnf-unknown">NAME</span> <span class="bnf-lit">::</span> <a href="s_annotations.html#%28elem._%28bnf-prod._%28.Pyret._ann%29%29%29" data-pltdoc="x">&#8249;ann&#8250;</a><span class="bnf-meta"> | </span><span class="bnf-lit bnf-unknown">NAME</span> <span class="bnf-lit">::</span> <a href="#%28elem._%28bnf-prod._%28.Pyret._contract-arrow-ann%29%29%29" data-pltdoc="x">&#8249;contract-arrow-ann&#8250;</a>
<a name="(elem._(bnf-prod._(.Pyret._contract-arrow-ann)))"></a><span class="bnf-rule">&#8249;contract-arrow-ann&#8250;</span><span class="bnf-meta">:</span> <span class="bnf-meta">(</span><a href="s_annotations.html#%28elem._%28bnf-prod._%28.Pyret._ann%29%29%29" data-pltdoc="x">&#8249;ann&#8250;</a> <span class="bnf-lit">,</span><span class="bnf-meta">)</span><span class="bnf-meta">*</span> <a href="s_annotations.html#%28elem._%28bnf-prod._%28.Pyret._ann%29%29%29" data-pltdoc="x">&#8249;ann&#8250;</a> <span class="bnf-lit">-&gt;</span> <a href="s_annotations.html#%28elem._%28bnf-prod._%28.Pyret._ann%29%29%29" data-pltdoc="x">&#8249;ann&#8250;</a>
<span data-prod="‹contract-arrow-ann›" class="bnf-phantom"></span><span class="bnf-meta">| </span><span class="bnf-lit">(</span> <span class="bnf-meta">(</span><span class="bnf-lit bnf-unknown">NAME</span> <span class="bnf-lit">::</span> <a href="s_annotations.html#%28elem._%28bnf-prod._%28.Pyret._ann%29%29%29" data-pltdoc="x">&#8249;ann&#8250;</a> <span class="bnf-lit">,</span><span class="bnf-meta">)</span><span class="bnf-meta">*</span> <span class="bnf-lit bnf-unknown">NAME</span> <span class="bnf-lit">::</span> <a href="s_annotations.html#%28elem._%28bnf-prod._%28.Pyret._ann%29%29%29" data-pltdoc="x">&#8249;ann&#8250;</a> <span class="bnf-lit">)</span> <span class="bnf-lit">-&gt;</span> <a href="s_annotations.html#%28elem._%28bnf-prod._%28.Pyret._ann%29%29%29" data-pltdoc="x">&#8249;ann&#8250;</a></p></blockquote><p><div class="SIntrapara">When weaving function annotations onto functions, Pyret enforces a few
restrictions:
</div><div class="SIntrapara"><ul><li><p>For a standalone function, the contract must immediately precede the
function definition, or must immediately precede an
<a href="testing.html#%28part._testing-blocks%29" data-pltdoc="x"><span class="pyret-highlight"><span class="stt">examples</span></span> or <span class="pyret-highlight"><span class="stt">check</span></span> block</a> that
immediately precedes the function definition.  (Whitespace or comments are not
important; extraneous definitions are.)</p><p><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p>is-even :: Number -&gt; Boolean

check:
  is-even(2) is true
end

fun is-even(n): num-modulo(n, 2) == 0 end</p></pre></pre></div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight bad-ex"><p>is-even :: Number -&gt; Boolean

something-irrelevant = 12345

fun is-even(n): num-modulo(n, 2) == 0 end</p></pre></pre></div></p></li><li><p><div class="SIntrapara">For mutually recursive functions, the contracts must be adjacent to the
functions, and must precede them.
</div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p># Contracts
is-even :: Number -&gt; Boolean
is-odd :: Number -&gt; Boolean
# Implementations
fun is-even(n): if n == 0: true else: is-odd(n - 1) end end
fun is-odd(n): if n == 0: false else: is-even(n - 1) end end</p></pre></pre></div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p># Is even?
is-even :: Number -&gt; Boolean
fun is-even(n): if n == 0: true else: is-odd(n - 1) end end
# Is odd?
is-odd :: Number -&gt; Boolean
fun is-odd(n): if n == 0: false else: is-even(n - 1) end end</p></pre></pre></div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight bad-ex"><p>is-odd :: Number -&gt; Boolean
fun is-even(n): if n == 0: true else: is-odd(n - 1) end end
is-even :: Number -&gt; Boolean  ## Does not precede definition of is-even
fun is-odd(n): if n == 0: false else: is-even(n - 1) end end</p></pre></pre></div></p></li><li><p><div class="SIntrapara">If a contract specifies argument names, then the names must match those
used by the function.
</div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p>is-even :: (n :: Number) -&gt; Boolean
fun is-even(n): num-modulo(n, 2) == 0 end</p></pre></pre></div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight bad-ex"><p>is-even :: (x :: Number) -&gt; Boolean # name does not match
fun is-even(n): ... end</p></pre></pre></div></p></li><li><p><div class="SIntrapara">If a contract is used for a function, then the function must not itself
be annotated.
</div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight good-ex"><p>is-even :: (n :: Number) -&gt; Boolean
fun is-even(n): num-modulo(n, 2) == 0 end</p></pre></pre></div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight bad-ex"><p>is-even :: (n :: Number) -&gt; Boolean # Redundant argument annotation
fun is-even(n :: Number): ... end</p></pre></pre></div><div class="SIntrapara"><pre class="pyret-block"><pre class="pyret-highlight bad-ex"><p>is-even :: (n :: Number) -&gt; Boolean # Redundant return annotation
fun is-even(n) -&gt; Boolean: ... end</p></pre></pre></div></p></li></ul></div></p><p>Note that using a contract on a function is <span style="font-style: italic">more expressive</span> than using
an annotated binding for a lambda.  <a href="Bindings.html#%28part._s~3aannotated-binding%29" data-pltdoc="x">Annotated bindings</a> do not
enforce all the components of an <a href="s_annotations.html#%28part._s~3aarrow-ann%29" data-pltdoc="x">arrow annotation</a>; they
merely ensure that the value being bound is in fact a function.  By contrast,
function contracts ensure the arguments and return values are annotated and
checked.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="s_declarations.html" title="backward to &quot;2.1.8 Declarations&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="s_forms.html" title="up to &quot;2.1 Language Constructs&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Statements.html" title="forward to &quot;2.1.10 Statements&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>